<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FahadFlix</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #141414; color: #fff; min-height: 100vh; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }
.container { max-width: 1100px; margin: 18px auto; padding: 12px; }

/* AUTH PAGE */
.auth-box { max-width: 420px; margin: 10vh auto; padding: 40px 30px; background: rgba(0,0,0,0.85); border-radius: 6px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.6); }
.auth-box input, .auth-box button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: none; }
.auth-box input { background: #333; border: 1px solid #555; color: #fff; }
.auth-box button { background: #e50914; color: #fff; font-weight: 700; cursor: pointer; transition: background 0.2s; }
.auth-box button:hover { background: #f6121d; }

/* PAGE TOGGLING */
.page { display: none; }
.active { display: block; }

h1,h2 { margin: 14px 0; text-align: center; }

/* PROFILES PAGE */
#profilesContainer { display: flex; flex-wrap: wrap; gap: 18px; justify-content: center; margin-top: 20px; }
.profile-card { width: 160px; background: transparent; padding: 8px; text-align: center; }
.profile-card img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; cursor: pointer; transition: transform 0.25s; }
.profile-card img:hover { transform: scale(1.08); }
.profile-card p { margin-top: 8px; font-size: 14px; }
.profile-card button { margin-top: 4px; width: 100%; padding: 4px 0; font-size: 12px; }

/* BUTTONS */
.btn { padding: 8px 12px; background: #e50914; border: none; border-radius: 6px; color: #fff; cursor: pointer; transition: background 0.2s; }
.btn:hover { background: #f6121d; }
.btn.ghost { background: transparent; border: 1px solid rgba(255,255,255,0.3); }
.btn.ghost:hover { background: rgba(255,255,255,0.1); }

/* ADD AREA */
.add-area { max-width: 520px; margin: 18px auto; padding: 12px; background: #161616; border-radius: 8px; display: flex; gap: 8px; align-items: center; }
.add-area input[type="text"], .add-area input[type="file"], .add-area select { flex: 1; padding: 10px; border-radius: 6px; border: none; background: #222; color: #fff; }
.add-area button { padding: 10px 12px; background: #e50914; border: none; color: #fff; border-radius: 6px; cursor: pointer; }

/* MOVIES & ROWS */
#moviesContainer { display: flex; flex-direction: column; gap: 20px; padding: 12px; }
.row { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; }
.row::-webkit-scrollbar { display: none; }
.movie-card { flex: 0 0 auto; width: 200px; background: #1d1d1d; border-radius: 8px; overflow: hidden; position: relative; cursor: pointer; transition: transform 0.25s; }
.movie-card:hover { transform: scale(1.05); z-index: 5; }
.movie-card img { width: 100%; height: 300px; object-fit: cover; }
.movie-card .title { position: absolute; bottom: 8px; left: 8px; font-size: 14px; background: rgba(0,0,0,0.6); padding: 4px 8px; border-radius: 4px; }

/* EPISODES */
.episode-card { background: #1f1f1f; padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 8px; }

/* PLAYER */
#player { margin: 20px auto; text-align: center; }
video { width: 95%; max-width: 980px; border-radius: 8px; background: #000; }
.controls { display: flex; gap: 8px; justify-content: center; margin-top: 12px; }

/* SEARCH */
#searchInput { width: 100%; padding: 10px; margin: 12px 0; border-radius: 6px; border: none; background: #222; color: #fff; }

/* RESPONSIVE */
@media(max-width:600px){ .add-area { flex-direction: column; align-items: stretch; } .movie-card img { height: 180px; } .profile-card img { height: 100px; } }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
</head>
<body>
<div class="container">

<!-- AUTH PAGE -->
<div id="authPage" class="page active">
  <div class="auth-box">
    <h2>Login or Sign Up</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn" class="btn ghost">Sign Up</button>
  </div>
</div>

<!-- PROFILES PAGE -->
<div id="profilesPage" class="page">
  <h1>Who's watching?</h1>
  <div class="add-area">
    <input id="newProfileName" type="text" placeholder="New profile name">
    <input id="newProfileImage" type="file" accept="image/*">
    <button id="addProfileBtn">Add</button>
  </div>
  <div id="profilesContainer"></div>
  <div style="text-align:center;margin-top:12px">
    <button id="signOutBtn" class="btn ghost">Sign Out</button>
  </div>
</div>

<!-- HOME PAGE -->
<div id="homePage" class="page">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1 id="welcomeTitle">Browse</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="switchProfileBtn" class="btn ghost">Switch Profile</button>
      <button id="logoutBtn" class="btn">Logout</button>
      <button id="adminToggleBtn" class="btn ghost" style="display:none">Admin Panel</button>
    </div>
  </div>
  <input id="searchInput" type="text" placeholder="Search movies or shows...">
  <div id="moviesContainer"></div>
</div>

<!-- EPISODES PAGE -->
<div id="episodesPage" class="page">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1 id="showTitle">Show</h1>
    <button id="backToHome" class="btn ghost">Back</button>
  </div>
  <div id="episodesContainer"></div>
</div>

<!-- PLAYER PAGE -->
<div id="playerPage" class="page">
  <h1 id="playerTitle">Player</h1>
  <div id="player">
    <video id="videoPlayer" controls crossorigin="anonymous"></video>
  </div>
  <div class="controls">
    <button class="btn" id="toggleSubsBtn">Toggle Subtitles</button>
    <button class="btn ghost" id="playerBackBtn">Back</button>
  </div>
</div>

<!-- ADMIN PAGE -->
<div id="adminPage" class="page">
  <h1>Admin Panel</h1>
  <div class="add-area">
    <input id="adminTitle" type="text" placeholder="Title">
    <input id="adminImg" type="text" placeholder="Image URL">
    <input id="adminSrc" type="text" placeholder="Video URL">
    <input id="adminSubs" type="text" placeholder="Subtitles URL (optional)">
    <select id="adminType">
      <option value="movies">Movie</option>
      <option value="shows">Show</option>
    </select>
    <button id="addMediaBtn">Add Media</button>
  </div>
  <div id="adminList"></div>
  <button id="saveToGithubBtn" class="btn">Save Changes to GitHub</button>
  <button onclick="showPage('home')" class="btn ghost">Back</button>
</div>

</div>

<script>
// ================== Firebase Config ================== //
const firebaseConfig = {
  apiKey: "AIzaSyCvd_IgPL3_gYjhfplngBboHWjSLRIhhIE",
  authDomain: "fahadflix-storage.firebaseapp.com",
  databaseURL: "https://fahadflix-storage-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "fahadflix-storage",
  storageBucket: "fahadflix-storage.appspot.com",
  messagingSenderId: "1064833913945",
  appId: "1:1064833913945:web:bf711e8b364fcfdf2b8d48"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database();
let currentUser=null, profiles=[], mediaData={movies:[], shows:[]};

// ================== Page Management ================== //
const pages = {
  auth: document.getElementById('authPage'),
  profiles: document.getElementById('profilesPage'),
  home: document.getElementById('homePage'),
  episodes: document.getElementById('episodesPage'),
  player: document.getElementById('playerPage'),
  admin: document.getElementById('adminPage')
};
function showPage(name) { Object.values(pages).forEach(p => p.classList.remove('active')); pages[name].classList.add('active'); }

// ================== Auth ================== //
document.getElementById('signInBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const pwd = document.getElementById('password').value.trim();
  if (!email || !pwd) return alert("Enter email & password");
  try {
    const userCred = await auth.signInWithEmailAndPassword(email, pwd);
    currentUser = userCred.user;
    await loadProfiles();
    await loadMediaData();
    showPage('profiles'); renderProfiles();
  } catch (e) { alert("Login failed: "+e.message); }
});

document.getElementById('signUpBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const pwd = document.getElementById('password').value.trim();
  if (!email || !pwd) return alert("Enter email & password");
  try {
    const userCred = await auth.createUserWithEmailAndPassword(email, pwd);
    currentUser = userCred.user;
    profiles = [{ name: "User 1", img: "https://via.placeholder.com/150" }];
    await db.ref('profiles/'+currentUser.uid).set(profiles);
    await loadMediaData();
    showPage('profiles'); renderProfiles();
  } catch (e) { alert("Signup failed: "+e.message); }
});

// ================== Profiles ================== //
async function loadProfiles() {
  const snapshot = await db.ref('profiles/'+currentUser.uid).once('value');
  if(snapshot.exists()) profiles = snapshot.val();
  else { profiles=[{name:"User 1",img:"https://via.placeholder.com/150"}]; await db.ref('profiles/'+currentUser.uid).set(profiles);}
}
async function saveProfiles() { if(currentUser) await db.ref('profiles/'+currentUser.uid).set(profiles); }

const profilesContainer = document.getElementById('profilesContainer');
document.getElementById('addProfileBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('newProfileName').value.trim();
  const file = document.getElementById('newProfileImage').files[0];
  if(!name){ alert('Enter name'); return; }
  if(!file){ alert('Pick an image'); return; }
  const reader = new FileReader();
  reader.onload = async e => {
    profiles.push({name,img:e.target.result});
    await saveProfiles();
    document.getElementById('newProfileName').value=''; document.getElementById('newProfileImage').value='';
    renderProfiles();
  };
  reader.readAsDataURL(file);
});

function renderProfiles(){
  profilesContainer.innerHTML='';
  profiles.forEach((p,i)=>{
    const div = document.createElement('div'); div.className='profile-card';
    div.innerHTML=`<img src="${p.img}" alt="${p.name}"><p>${p.name}</p>
      <button class="btn ghost editBtn">Edit</button>
      <button class="btn ghost deleteBtn">Delete</button>`;
    div.querySelector('img').addEventListener('click', async ()=>{
      showPage('home');
      document.getElementById('welcomeTitle').innerText='Welcome, '+p.name;
      if(currentUser?.email==='fxhdle2@gmail.com') document.getElementById('adminToggleBtn').style.display='inline-block';
      renderHome();
    });
    div.querySelector('.editBtn').addEventListener('click', ()=>{ const newName=prompt('Edit profile name:',p.name); if(newName){ profiles[i].name=newName; saveProfiles().then(renderProfiles); } });
    div.querySelector('.deleteBtn').addEventListener('click', async ()=>{ profiles.splice(i,1); await saveProfiles(); renderProfiles(); });
    profilesContainer.appendChild(div);
  });
}

// ================== Sign Out / Switch ================== //
document.getElementById('signOutBtn').addEventListener('click', async ()=>{ await auth.signOut(); currentUser=null; showPage('auth'); });
document.getElementById('logoutBtn').addEventListener('click', async ()=>{ await auth.signOut(); currentUser=null; showPage('auth'); });
document.getElementById('switchProfileBtn').addEventListener('click', ()=> showPage('profiles'));
document.getElementById('adminToggleBtn').addEventListener('click', ()=>{ if(currentUser?.email==='fxhdle2@gmail.com') showPage('admin'); else alert('Access denied'); });

// ================== Load Media from GitHub ================== //
async function loadMediaData(){
  try{
    const response = await fetch('https://raw.githubusercontent.com/FXHDLE112/tes-html/main/movies.json');
    mediaData = await response.json();
    if(!mediaData.movies) mediaData.movies=[];
    if(!mediaData.shows) mediaData.shows=[];
  }catch(e){ console.error('Failed to load media:',e); mediaData={movies:[],shows:[]}; }
}

// ================== Home Page ================== //
const moviesContainer = document.getElementById('moviesContainer');
document.getElementById('searchInput').addEventListener('input', ()=> renderHome(document.getElementById('searchInput').value.trim()));

function renderHome(search=''){
  moviesContainer.innerHTML='';

  [['Movies',mediaData.movies],['Shows',mediaData.shows]].forEach(([label,arr])=>{
    let filtered = arr || [];
    if(filtered.length && search) filtered = filtered.filter(m=>m.title.toLowerCase().includes(search.toLowerCase()));
    if(filtered.length){
      const titleEl = document.createElement('h2'); titleEl.innerText = label; moviesContainer.appendChild(titleEl);
      const row = document.createElement('div'); row.className='row';
      filtered.forEach(m=>{
        const card = document.createElement('div'); card.className='movie-card';
        card.innerHTML=`<img src="${m.img||''}"><div class="title">${m.title||'Untitled'}</div>`;
        card.addEventListener('click', ()=> m.src?openPlayer(m.title,m.src,m.subtitles):openShow(m));
        row.appendChild(card);
      });
      moviesContainer.appendChild(row);
    }
  });
}

// ================== Show / Episodes ================== //
document.getElementById('backToHome').addEventListener('click', ()=> showPage('home'));
function openShow(show){
  showPage('episodes');
  document.getElementById('showTitle').innerText=show.title||'Show';
  const container=document.getElementById('episodesContainer'); container.innerHTML='';
  if(show.seasons?.length>1){
    const seasonSelect=document.createElement('select');
    show.seasons.forEach((s,i)=>{ const total=s.episodes?.length||0; const available=(s.episodes?.filter(ep=>ep.src).length)||0; const option=document.createElement('option'); option.value=i; option.text=`Season ${s.season||i+1} (${available}/${total} Available)`; seasonSelect.appendChild(option); });
    container.appendChild(seasonSelect);
    seasonSelect.addEventListener('change', ()=> renderEpisodes(show.seasons[seasonSelect.value]));
  }
  if(show.seasons?.[0]) renderEpisodes(show.seasons[0]);
}
function renderEpisodes(season){
  const container=document.getElementById('episodesContainer'); container.innerHTML='';
  season.episodes.forEach(ep=>{
    const div=document.createElement('div'); div.className='episode-card'; div.innerText=ep.title||'Episode';
    div.addEventListener('click', ()=> openPlayer(ep.title,ep.src,ep.subtitles));
    container.appendChild(div);
  });
}

// ================== Player ================== //
document.getElementById('playerBackBtn').addEventListener('click', ()=> showPage('home'));
const videoPlayer=document.getElementById('videoPlayer');
function openPlayer(title,src,subs){
  showPage('player'); document.getElementById('playerTitle').innerText=title;
  videoPlayer.src=src; videoPlayer.load(); videoPlayer.play();
}

// ================== Admin ================== //
document.getElementById('addMediaBtn').addEventListener('click', ()=>{
  const t=document.getElementById('adminTitle').value.trim();
  const i=document.getElementById('adminImg').value.trim();
  const s=document.getElementById('adminSrc').value.trim();
  const sub=document.getElementById('adminSubs').value.trim();
  const type=document.getElementById('adminType').value;
  if(!t || !i || !s) return alert('Fill title, image & src');
  mediaData[type].push({title:t,img:i,src:s,subtitles:sub});
  alert('Media added'); renderHome();
  document.getElementById('adminTitle').value=''; document.getElementById('adminImg').value=''; document.getElementById('adminSrc').value=''; document.getElementById('adminSubs').value='';
});

// ================== Auth State ================== //
auth.onAuthStateChanged(user=>{ if(user){ currentUser=user; loadProfiles().then(()=>renderProfiles()); loadMediaData().then(()=>renderHome()); showPage('profiles'); } else showPage('auth'); });

</script>
</body>
</html>
