<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FahadFlix</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
body{background:#141414;color:#fff;min-height:100vh}
.container{max-width:1100px;margin:18px auto;padding:12px}
.auth-box{max-width:420px;margin:60px auto;padding:20px;background:#1f1f1f;border-radius:10px;text-align:center}
.auth-box input,.auth-box button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none}
.auth-box input{background:#333;color:#fff}
.auth-box button{background:#e50914;color:#fff;font-weight:700;cursor:pointer}
.page{display:none}
.active{display:block}
h1,h2{margin:14px 0;text-align:center}
#profilesContainer{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;margin-top:20px}
.profile-card{width:140px;text-align:center;background:#1b1b1b;padding:8px;border-radius:10px;position:relative}
.profile-card img{width:120px;height:120px;object-fit:cover;border-radius:12px;cursor:pointer}
.profile-card p{margin:6px 0}
.profile-card button{margin-top:4px;width:100%;padding:4px 0;font-size:12px}
.btn{padding:8px 12px;background:#e50914;border:none;border-radius:6px;color:#fff;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.3)}
.add-area{max-width:520px;margin:18px auto;padding:12px;background:#161616;border-radius:8px;display:flex;gap:8px;align-items:center}
.add-area input[type="text"], .add-area input[type="file"], .add-area select{flex:1;padding:10px;border-radius:6px;border:none;background:#222;color:#fff}
.add-area button{padding:10px 12px;background:#e50914;border:none;color:#fff;border-radius:6px;cursor:pointer}
#moviesContainer{display:flex;flex-direction:column;gap:20px;padding:12px}
.row{display:flex;gap:12px;overflow-x:auto}
.movie-card{background:#1d1d1d;border-radius:10px;overflow:hidden;cursor:pointer;position:relative;min-width:160px}
.movie-card img{width:100%;display:block;height:240px;object-fit:cover;transition:transform .25s}
.movie-card:hover img{transform:scale(1.05)}
.movie-card .title{position:absolute;left:10px;bottom:10px;background:rgba(0,0,0,0.55);padding:6px 8px;border-radius:6px}
.episode-card{background:#1f1f1f;padding:12px;border-radius:8px;cursor:pointer;margin-bottom:8px}
#player{margin:20px auto;text-align:center}
video{width:95%;max-width:980px;border-radius:8px;background:#000}
.controls{display:flex;gap:8px;justify-content:center;margin-top:12px}
#searchInput{width:100%;padding:10px;margin:12px 0;border-radius:6px;border:none;background:#222;color:#fff}
.review-section{margin-top:20px;padding:12px;background:#1b1b1b;border-radius:8px}
.review-form{margin-bottom:14px}
.review-form textarea{width:100%;padding:8px;border-radius:6px;border:none;background:#222;color:#fff;margin-top:6px}
.review-form select,.review-form button{padding:8px;border-radius:6px;border:none;margin-top:8px}
.review-item{padding:8px;border-bottom:1px solid #333}
.review-item:last-child{border-bottom:none}
.review-rating{color:gold}
@media(max-width:600px){.add-area{flex-direction:column;align-items:stretch}.movie-card img{height:180px}.profile-card img{width:100px;height:100px}}
</style>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
</head>
<body>
<div class="container">

<!-- AUTH PAGE -->
<div id="authPage" class="page active">
  <div class="auth-box">
    <h2>Login or Sign Up</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn" class="btn ghost">Sign Up</button>
  </div>
</div>

<!-- PROFILES PAGE -->
<div id="profilesPage" class="page">
  <h1>Who's watching?</h1>
  <div class="add-area">
    <input id="newProfileName" type="text" placeholder="New profile name">
    <input id="newProfileImage" type="file" accept="image/*">
    <button id="addProfileBtn">Add</button>
  </div>
  <div id="profilesContainer"></div>
  <div style="text-align:center;margin-top:12px">
    <button id="signOutBtn" class="btn ghost">Sign Out</button>
  </div>
</div>

<!-- HOME PAGE -->
<div id="homePage" class="page">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1 id="welcomeTitle">Browse</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="switchProfileBtn" class="btn ghost">Switch Profile</button>
      <button id="logoutBtn" class="btn">Logout</button>
      <button id="adminToggleBtn" class="btn ghost" style="display:none">Admin Panel</button>
    </div>
  </div>
  <input id="searchInput" type="text" placeholder="Search movies or shows...">
  <div id="moviesContainer"></div>
</div>

<!-- PLAYER PAGE -->
<div id="playerPage" class="page">
  <h1 id="playerTitle">Player</h1>
  <div id="player">
    <video id="videoPlayer" controls crossorigin="anonymous"></video>
  </div>
  <div class="controls">
    <button class="btn" id="toggleSubsBtn">Toggle Subtitles</button>
    <button class="btn ghost" id="playerBackBtn">Back</button>
    <button class="btn" id="startPartyBtn">Start Watch Party</button>
    <button class="btn ghost" id="joinPartyBtn">Join Watch Party</button>
  </div>
  <!-- Reviews Section -->
  <div class="review-section">
    <h2>Reviews & Ratings</h2>
    <div id="averageRating"></div>
    <div class="review-form">
      <label>Rate this:</label>
      <select id="reviewRating">
        <option value="5">⭐⭐⭐⭐⭐</option>
        <option value="4">⭐⭐⭐⭐</option>
        <option value="3">⭐⭐⭐</option>
        <option value="2">⭐⭐</option>
        <option value="1">⭐</option>
      </select>
      <textarea id="reviewText" placeholder="Write your review..."></textarea>
      <button id="submitReviewBtn" class="btn">Submit Review</button>
    </div>
    <div id="reviewsList"></div>
  </div>
</div>

</div>

<script>
// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyCvd_IgPL3_gYjhfplngBboHWjSLRIhhIE",
  authDomain: "fahadflix-storage.firebaseapp.com",
  databaseURL: "https://fahadflix-storage-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "fahadflix-storage",
  storageBucket: "fahadflix-storage.appspot.com",
  messagingSenderId: "1064833913945",
  appId: "1:1064833913945:web:bf711e8b364fcfdf2b8d48"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database();
let currentUser=null, mediaData={movies:[], shows:[]};
let currentPartyId=null, currentEpisode=null;

// PAGES
const pages={ auth:document.getElementById('authPage'), profiles:document.getElementById('profilesPage'), home:document.getElementById('homePage'), player:document.getElementById('playerPage') };
function showPage(name){ Object.values(pages).forEach(el=>el.classList.remove('active')); pages[name].classList.add('active'); }

// AUTH
document.getElementById('signInBtn').addEventListener('click', async ()=>{
  const email=document.getElementById('email').value.trim();
  const pwd=document.getElementById('password').value.trim();
  if(!email||!pwd) return alert('Enter email & password');
  try{
    const userCred=await auth.signInWithEmailAndPassword(email,pwd);
    currentUser=userCred.user; showPage('home'); loadMediaData();
  } catch(e){ alert("Login failed: "+e.message); }
});
document.getElementById('signUpBtn').addEventListener('click', async ()=>{
  const email=document.getElementById('email').value.trim();
  const pwd=document.getElementById('password').value.trim();
  if(!email||!pwd) return alert('Enter email & password');
  try{
    const userCred=await auth.createUserWithEmailAndPassword(email,pwd);
    currentUser=userCred.user; showPage('home'); loadMediaData();
  } catch(e){ alert("Signup failed: "+e.message); }
});

// LOAD MEDIA
async function loadMediaData(){
  try{
    const response = await fetch('https://raw.githubusercontent.com/FXHDLE112/tes-html/main/movies.json');
    mediaData = await response.json();
  } catch(e){ mediaData={movies:[], shows:[]}; }
}

// PLAYER
const videoPlayer=document.getElementById('videoPlayer');
document.getElementById('playerBackBtn').addEventListener('click', ()=> showPage('home'));
document.getElementById('toggleSubsBtn').addEventListener('click', ()=>{
  const tracks=videoPlayer.textTracks||[];
  for(let i=0;i<tracks.length;i++) tracks[i].mode=(tracks[i].mode==='showing'?'hidden':'showing');
});
async function openPlayer(title,src,subs){
  showPage('player'); 
  videoPlayer.src=src||''; 
  document.getElementById('playerTitle').innerText=title;
  if(subs){ const track=document.createElement('track'); track.kind='subtitles'; track.src=subs; track.default=true; videoPlayer.appendChild(track); }
  currentEpisode={title,src,subs};
  loadReviews(title);
}

// WATCH PARTY
document.getElementById('startPartyBtn').addEventListener('click', async ()=>{
  if(!currentUser) return alert("Login required.");
  currentPartyId = Date.now().toString();
  await db.ref(`parties/${currentPartyId}`).set({host:currentUser.uid,src:videoPlayer.src,currentTime:videoPlayer.currentTime,playing:!videoPlayer.paused});
  alert("Watch Party started! Share ID: "+currentPartyId);
  videoPlayer.ontimeupdate=()=> db.ref(`parties/${currentPartyId}/currentTime`).set(videoPlayer.currentTime);
  videoPlayer.onplay=()=> db.ref(`parties/${currentPartyId}/playing`).set(true);
  videoPlayer.onpause=()=> db.ref(`parties/${currentPartyId}/playing`).set(false);
});
document.getElementById('joinPartyBtn').addEventListener('click', async ()=>{
  const partyId=prompt("Enter Watch Party ID:");
  if(!partyId) return;
  currentPartyId=partyId;
  const snapshot=await db.ref(`parties/${partyId}`).once('value');
  if(!snapshot.exists()) return alert("Party not found.");
  const partyData=snapshot.val();
  showPage('player');
  videoPlayer.src=partyData.src;
  videoPlayer.currentTime=partyData.currentTime||0;
  try{ await videoPlayer.play(); }catch(e){ alert("Click play to start video."); }
  db.ref(`parties/${partyId}`).on('value',snap=>{
    const d=snap.val(); if(!d) return;
    if(Math.abs(videoPlayer.currentTime-d.currentTime)>2) videoPlayer.currentTime=d.currentTime;
    if(d.playing && videoPlayer.paused) videoPlayer.play().catch(()=>{});
    if(!d.playing && !videoPlayer.paused) videoPlayer.pause();
  });
});

// REVIEWS
async function loadReviews(title){
  const snapshot=await db.ref(`reviews/${title}`).once('value');
  const reviewsData=snapshot.exists()?snapshot.val():{};
  const reviewsList=document.getElementById('reviewsList');
  const avgRatingEl=document.getElementById('averageRating');
  reviewsList.innerHTML='';
  let total=0,count=0;
  Object.values(reviewsData).forEach(r=>{
    total+=r.rating; count++;
    const div=document.createElement('div'); div.className='review-item';
    div.innerHTML=`<div class="review-rating">${'⭐'.repeat(r.rating)}</div><p>${r.text||''}</p><small>by ${r.userEmail||'Anonymous'}</small>`;
    reviewsList.appendChild(div);
  });
  avgRatingEl.innerHTML=count?`Average Rating: ${(total/count).toFixed(1)} ⭐ (${count} reviews)`:"No reviews yet.";
}
document.getElementById('submitReviewBtn').addEventListener('click', async ()=>{
  if(!currentUser) return alert("Login required.");
  const rating=parseInt(document.getElementById('reviewRating').value);
  const text=document.getElementById('reviewText').value.trim();
  const title=document.getElementById('playerTitle').innerText;
  await db.ref(`reviews/${title}/${currentUser.uid}`).set({rating,text,userEmail:currentUser.email});
  document.getElementById('reviewText').value=''; loadReviews(title);
});
</script>
</body>
</html>
